<!DOCTYPE html>
<html>
<head>
    <title>Register for Notifications</title>
    <style>
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f0f2f5; text-align: center; }
        .container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        p { color: #666; }
        #status { font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Registering Your Device...</h1>
        <p>Please grant permission when prompted to receive notifications.</p>
        <p id="status">Initializing...</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>

    <script>
        // ====================================================================
        // IMPORTANT: Replace the placeholder values below with your own
        // ====================================================================

        // 1. PASTE YOUR WEB firebaseConfig OBJECT HERE (from Firebase Console)
       const firebaseConfig = {
        apiKey: "AIzaSyDaBgWQvAyhzViUrlljlNa0HQ-C7dcG364",
        authDomain: "anveshak-omt.firebaseapp.com",
        projectId: "anveshak-omt",
        storageBucket: "anveshak-omt.firebasestorage.app",
        messagingSenderId: "196448375676",
        appId: "1:196448375676:web:6e50d4c2e43ca6e3060af9"
};

        // 2. PASTE YOUR RENDER BACKEND URL HERE
        const BACKEND_URL = 'https://anveshak-firebase.onrender.com';

        // 3. PASTE YOUR VAPID KEY HERE (from Firebase Console > Project Settings > Cloud Messaging)
        const VAPID_KEY = 'BP4pMO2SkKYdxSwrr1WtJMvBMY8nask9BrT_gHhDsfT4pZIuZz3l_RudeFKxpiTfMHs-4Kr4GemdvQ2ifVsytwo	';


        // --- DO NOT EDIT BELOW THIS LINE ---

        firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();
        const statusEl = document.getElementById('status');

        // This function runs automatically when the page loads
        window.onload = function() {
            statusEl.textContent = 'Requesting notification permission...';
            Notification.requestPermission().then((permission) => {
                if (permission === 'granted') {
                    statusEl.textContent = 'Permission granted. Getting device token...';
                    return messaging.getToken({ vapidKey: VAPID_KEY });
                } else {
                    statusEl.textContent = 'Permission denied. You will not receive notifications.';
                    throw new Error('Permission denied');
                }
            }).then(token => {
                if (token) {
                    console.log('FCM Token:', token);
                    statusEl.textContent = 'Registering device with server...';
                    // Send this token to your backend to save it
                    return fetch(`${BACKEND_URL}/register-device`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ token: token, platform: 'web' })
                    });
                }
            }).then(response => {
                if (response && response.ok) {
                    statusEl.textContent = 'Device registered successfully!';
                } else if (response) {
                    statusEl.textContent = `Error registering device. Server responded with status: ${response.status}`;
                }
            }).catch(err => {
                console.error('An error occurred:', err);
                // Avoid overwriting a specific "Permission denied" message
                if (statusEl.textContent.includes('...')) {
                   statusEl.textContent = 'An error occurred during registration.';
                }
            });
        };
    </script>
</body>
</html>